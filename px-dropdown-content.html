<!--
    Relative paths assume component is being run from inside an app or another component, where dependencies are flat
    siblings. When this component is run from its own repo (e.g. ui tests, examples), we assume the server is started with
    'grunt depserve' (or similar server setup) to enable correct finding of bower dependencies for local runs
    See https://github.sw.ge.com/jreichenberg/grunt-dep-serve#why-do-we-need-this
-->
<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../px-tooltip/px-tooltip.html" />
<!--
Element providing the content for the px-dropdown element

##### Usage

    <px-dropdown-content class="px-dropdown-content" items='[{"key":"one", "val": "One"}, {"key":"two", "val": "Two"}]'>

@element px-dropdown-content
@blurb Element to contain content of a dropdown menu.
@homepage index.html
@demo demo.html
-->
<dom-module id="px-dropdown-content">
  <link rel="import" type="css" href="css/px-dropdown-content.css" />
  <template>
      <div class="px-dropdown--content" id="dropdown" hidden$="{{!menuOpen}}">
        <ul class="px-dropdown--list list-bare">
          <template is="dom-repeat" items="{{items}}">
            <li class="px-dropdown--listitem u-ph-- u-pt--" onclick={{_clickFire(item.val)}}>{{item.val}}
              <template is="dom-if" if="{{_includeTooltip(item.val)}}">
                <px-tooltip tooltip-message="{{item.val}}"></px-tooltip>
              </template>
            </li>
          </template>
        </ul>
      </div>
  </template>
</dom-module>
<script>
  Polymer({

    is: 'px-dropdown-content',

    /**
     * Properties block, expose attribute values to the DOM via 'reflect'
     *
     * @property properties
     * @type Object
     */
    properties: {
      items: {
        type: Array,
        notify: true,
        value: function() {
          return [];
        }
      },
      menuOpen: {
        type: Boolean,
        notify: true,
        value: false
      },
      width: {
        type: Number,
        value: 0,
        observer: '_setWidth'
      },
      /**
       * Maximum number of characters in a container.  Optional.
       *
       *      <px-dropdown-content max-cont-character-width="10" ...></px-dropdown-content>
       *
       * @default no maximum, will be used to calculate whether the dropdown will have a tooltip and ellipsis
       */
      maxContCharacterWidth: {
        type: Number,
        value: 0
      }
    },
    /**
     * Open dropdown menu content
     *
     * @method open
     */
    open: function() {
      this.menuOpen = true;
    },
    /**
     * Close dropdown menu content
     *
     * @method close
     */
    close: function() {
      this.menuOpen = false;
    },
    /**
     *  Deselect all dropdown checkboxes
     *
     * @method deselectAll
     */
    deselectAll: function() {
      this.items.forEach(function(){
        this.checked = false;
      });
    },
    /**
     *  Select all dropdown checkboxes
     *
     * @method selectAll
     */
    selectAll: function() {
      this.items.forEach(function(){
        this.checked = true;
      });
    },
    _setWidth: function() {
      this.$.dropdown.style.width = (this.width + 15) + 'px';
    },
    _includeTooltip: function(value) {
      //find the container max character passed in
      var maxContWidth = this.maxContCharacterWidth;
      if(value === null || value === undefined || typeof value === 'string' && value.trim().length === 0) {
        return false;
      }
      //find out if the character count in the passed value is higher than the allowed max. if it is, we show the tooltip.
      return (maxContWidth !== undefined && maxContWidth !== null && maxContWidth !== 0) ? (value.length > maxContWidth) : false;
    },
    _clickFire: function(value) {
      this.fire('px-dropdown-click', value);
    }
  });
</script>
